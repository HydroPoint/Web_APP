<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Título específico para esta vista -->
    <title>Gestión de Producción (ERP + Contenido)</title> 
    
    <!-- Recursos de Estilo (Copiados de tu INDEX.html) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- 
      INICIO: Estilos CSS copiados de FINANZAS.html 
      Se incluyen TODOS para mantener la consistencia visual.
    -->
    <style>
      /* Define la fuente base para toda la página */
      body {
          font-family: 'Inter', sans-serif;
          background-color: #f3f4f6; /* bg-gray-100 */
      }
      
      /* ... (Estilos de logo, screensaver, footer-card, etc. sin cambios) ... */
      /* --- ESTILOS PARA LOS BOTONES "LOGO" --- */
      .logos-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        width: 100%;
        gap: 1rem; /* 16px */
        transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
      }
      .logo {
        min-height: 120px;
        display: flex;
        flex-direction: column; 
        align-items: center;
        justify-content: center;
        gap: 12px;
        padding: 16px; 
        border-radius: 12px;
        transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
        cursor: pointer;
      }
      .logo img {
        width: 140px;
        height: 140px;
        object-fit: contain;
        transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
      }
      .logo-title {
        font-size: 1rem;
        font-weight: 600;
        text-align: center;
        transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
      }
      .logo:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      }
      .logos-container:hover .logo:not(:hover) {
        transform: scale(0.95);
        opacity: 0.7;
        filter: none;
      }
      
      /* --- ESTILOS PARA EL SCREENSAVER (Marquee) --- */
      #screensaver-screen .logo-container {
          display: flex;
          justify-content: center;
          align-items: center;
          width: 160px;
          height: 160px;
          border-radius: 50%;
          background: #fff;
          border: 9px solid #DEE1E4;
          overflow: hidden;
          animation: cloud-loop-ss 0.7s ease infinite alternate;
      }
      #screensaver-screen .logo-track {
          display: flex;
          width: calc(2 * (4 * (100px + 16px))); 
          animation: marquee 10s linear infinite;
      }
      #screensaver-screen .logo-track img {
          width: 100px;
          margin: 0 8px;
      }
      @keyframes marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(-50%); } 
      }
      @keyframes cloud-loop-ss {
          0% { transform: translateY(5px); }
          100% { transform: translateY(-5px); }
      }

      /* --- ESTILOS PARA EL FOOTER Y FLIP COUNTERS --- */
      .footer-card-grid {
        display: grid;
        grid-template-columns: repeat(1, 1fr); 
        gap: 1.5rem; /* 24px */
      }
      @media (min-width: 768px) {
        .footer-card-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (min-width: 1024px) {
        .footer-card-grid {
          grid-template-columns: repeat(4, 1fr);
        }
      }
      .footer-card {
        background-color: white;
        border-radius: 0.5rem; /* 8px */
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        padding: 0.75rem; /* 12px - TAMAÑO REDUCIDO */
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem; /* 4px */
      }
      .footer-card-title {
        font-size: 0.875rem; /* 14px */
        font-weight: 500;
        color: #6b7280; /* text-gray-500 */
      }
      
      /* --- INICIO: NUEVOS ESTILOS FOOTER --- */
      .card {
        height: 70px; /* Altura fija */
        background: #00008B;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: left;
        backdrop-filter: blur(10px);
        transition: 0.5s ease-in-out;
        padding: 0 10px; /* Padding horizontal */
      }
      .card:hover {
        cursor: pointer;
        transform: scale(1.05);
      }
      .img {
        width: 50px;
        height: 50px;
        margin-left: 10px;
        border-radius: 10px;
        background: linear-gradient(#d7cfcf, #9198e5);
      }
      .card:hover > .img {
        transition: 0.5s ease-in-out;
        background: linear-gradient(#9198e5, #712020);
      }
      .textBox {
        width: calc(100% - 70px); /* Ajustado al nuevo padding/margin */
        margin-left: 10px;
        color: white;
      }
      .textContent {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .span {
        font-size: 10px;
        color: #aaa; /* Color más suave para el título */
      }
      .h1 {
        font-size: 16px;
        font-weight: bold;
      }
      .p {
        font-size: 12px;
        font-weight: lighter;
        color: #ddd; /* Color más suave para el dato secundario */
      }
      /* --- FIN: NUEVOS ESTILOS FOOTER --- */
      .tick {
          font-size: 1.5rem; /* 24px - TAMAÑO REDUCIDO */
          font-weight: 600;
          white-space: nowrap; 
      }
      .tick-green { color: #22c55e; } /* text-green-500 */
      .tick-red { color: #ef4444; }   /* text-red-500 */

      /* --- INICIO: ESTILOS PARA PESTAÑAS (TABS) --- */
      .tab-button {
          padding: 0.75rem 1rem; /* Más padding */
          font-size: 1rem; /* Más grande */
          font-weight: 600;
          color: #6b7280; /* text-gray-500 */
          background-color: transparent;
          border-bottom: 3px solid transparent; /* Borde más grueso */
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 0.5rem; /* Espacio para icono */
      }
      .tab-button:hover {
          color: #1d4ed8; /* text-blue-700 */
          border-bottom-color: #d1d5db; /* border-gray-300 */
      }
      .tab-button.active {
          color: #1d4ed8; /* text-blue-700 */
          border-bottom-color: #1d4ed8; /* border-blue-700 */
      }
      .tab-button svg {
          width: 1.25rem;
          height: 1.25rem;
      }
      /* --- FIN: ESTILOS PARA PESTAÑAS (TABS) --- */

      /* --- INICIO: ESTILOS PARA CALENDARIO (NUEVO) --- */
      .calendar-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1rem;
      }
      .calendar-header-title {
          font-size: 1.125rem;
          font-weight: 600;
      }
      .calendar-header button {
          background: #f3f4f6;
          border: 1px solid #d1d5db;
          border-radius: 0.375rem;
          padding: 0.25rem 0.5rem;
          transition: all 0.2s ease;
      }
      .calendar-header button:hover {
          background: #e5e7eb;
      }
      .calendar-grid {
          display: grid;
          grid-template-columns: repeat(7, 1fr);
          gap: 1px;
          background-color: #e5e7eb; /* Color de las líneas */
          border: 1px solid #e5e7eb;
          border-radius: 0.375rem;
          overflow: hidden;
      }
      .calendar-day-header {
          font-size: 0.75rem;
          font-weight: 600;
          text-align: center;
          padding: 0.5rem 0;
          background-color: #f9fafb; /* bg-gray-50 */
      }
      .calendar-day {
          position: relative;
          min-height: 80px;
          padding: 0.5rem;
          background-color: #fff;
          font-size: 0.875rem;
      }
      .calendar-day-number {
          font-weight: 500;
      }
      .calendar-day.other-month {
          background-color: #f9fafb; /* bg-gray-50 */
          color: #9ca3af; /* text-gray-400 */
      }
      .calendar-day.today .calendar-day-number {
          background-color: #3b82f6; /* bg-blue-500 */
          color: white;
          border-radius: 50%;
          width: 1.75rem;
          height: 1.75rem;
          display: inline-flex;
          align-items: center;
          justify-content: center;
      }
      .calendar-event {
          font-size: 0.75rem;
          padding: 0.25rem 0.5rem;
          background-color: #ecfdf5; /* bg-green-50 */
          color: #065f46; /* text-green-800 */
          border-radius: 0.25rem;
          margin-top: 0.25rem;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
      }
      /* --- FIN: ESTILOS PARA CALENDARIO --- */

      /* --- INICIO: ESTILOS BANCO DE IDEAS (NUEVO) --- */
      .idea-card-tag {
        font-size: 0.75rem;
        font-weight: 500;
        padding: 0.125rem 0.5rem;
        border-radius: 9999px; /* pill */
        position: absolute;
        top: 0.75rem; /* p-3 */
        right: 0.75rem; /* p-3 */
      }
      .tag-producto {
        background-color: #dbeafe; /* bg-blue-100 */
        color: #1e40af; /* text-blue-800 */
      }
      .tag-contenido {
        background-color: #ede9fe; /* bg-purple-100 */
        color: #5b21b6; /* text-purple-800 */
      }
      .tag-campana {
        background-color: #fef3c7; /* bg-yellow-100 */
        color: #b45309; /* text-yellow-800 */
      }
      
      /* --- INICIO: ESTILOS KANBAN (MODIFICADO) --- */
      .kanban-board-container {
          /* (Se eliminó overflow-x: auto y padding-bottom) */
          -ms-overflow-style: none;  /* IE and Edge */
          scrollbar-width: none;  /* Firefox */
      }
      .kanban-board-container::-webkit-scrollbar {
          display: none; /* Chrome, Safari, Opera */
      }
      .kanban-board {
          display: grid; /* MODIFICADO: de flex a grid */
          grid-template-columns: repeat(3, 1fr); /* MODIFICADO: 3 columnas */
          gap: 1rem;
          /* (Se eliminó min-width: max-content) */
      }
      .kanban-column {
          width: 100%; /* MODIFICADO: de 300px a 100% */
          flex-shrink: 0;
          background-color: #f3f4f6; /* bg-gray-100 */
          border-radius: 0.5rem; /* rounded-lg */
          display: flex;
          flex-direction: column;
      }
      .kanban-column-title {
          padding: 0.75rem 1rem;
          font-weight: 600;
          color: #1f2937; /* text-gray-800 */
          border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
      }
      .kanban-card-list {
          padding: 0.5rem;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
          min-height: 200px; /* MODIFICADO: Aumentado para más espacio */
          overflow-y: auto; /* Para listas largas */
          flex-grow: 1;
      }
      .kanban-card {
          background-color: #fff;
          border-radius: 0.5rem;
          padding: 0.75rem;
          box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
          border: 1px solid #e5e7eb;
          cursor: move;
      }
      .kanban-card-title {
          font-weight: 600;
          color: #111827; /* text-gray-900 */
          font-size: 0.875rem;
      }
      .kanban-card-pills {
          display: flex;
          flex-wrap: wrap;
          gap: 0.5rem;
          margin-top: 0.5rem;
      }
      .kanban-card-pill {
          font-size: 0.75rem; /* text-xs */
          font-weight: 500; /* font-medium */
          padding: 0.125rem 0.5rem; /* px-2 py-0.5 */
          border-radius: 9999px; /* rounded-full */
      }
      .kanban-empty, .kanban-loader {
          padding: 1rem;
          text-align: center;
          font-size: 0.875rem;
          color: #6b7280; /* text-gray-500 */
      }
      /* --- FIN: ESTILOS KANBAN --- */

      /* --- FIN: ESTILOS BANCO DE IDEAS --- */

    </style>
    <!-- FIN: Estilos CSS copiados de FINANZAS.html -->
</head>

<body class="h-full bg-gray-100">

    <!-- 
      HEADER DE PÁGINA:
      Copiado de FINANZAS.html
    -->
    <header class="w-full bg-blue-600">
        <div class="w-full max-w-7xl mx-auto flex justify-between items-center pt-8 pb-10 px-4 sm:px-6 lg:px-8"> <!-- Padding responsivo -->
            
            <!-- Logo Interactivo -->
            <img data-src-key="logo" alt="Logo" 
                 class="h-10 w-auto cursor-pointer transition-all duration-300 ease-in-out hover:scale-110 active:scale-95 hover:drop-shadow-lg" 
                 onclick="handleNavigation('INDEX')">
            
            <h1 id="header-title" class="text-3xl font-bold text-white hidden md:block">Gestión de Producción y Contenido</h1> <!-- Título actualizado -->
            
            <!-- Botón de Volver (NUEVO DISEÑO) -->
            <button
              id="btn-back-to-search" 
              onclick="handleNavigation('INDEX')"
              type="button"
              class="bg-white text-center w-48 rounded-2xl h-14 relative text-blue-700 text-xl font-semibold border-4 border-white group"
            >
              <div
                class="bg-blue-600 rounded-xl h-12 w-1/4 grid place-items-center absolute left-0 top-0 group-hover:w-full z-10 duration-500"
              >
                <svg
                  class="w-6 h-6"
                  viewBox="0 0 1024 1024"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill="#FFFFFF" 
                    d="M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64z"
                  ></path>
                  <path
                    fill="#FFFFFF"
                    d="m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312L237.248 512z"
                  ></path>
                </svg>
              </div>
              <p class="translate-x-4 transition-transform duration-500 group-hover:translate-x-0">Volver</p> 
            </button>
        </div>
    </header>

    <!-- 
      NUEVO CONTENIDO PRINCIPAL: PRODUCCIÓN 
    -->
    <main class="w-full max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- INICIO: Nueva Navegación Principal de Pestañas -->
        <div class="border-b border-gray-200 mb-6 bg-white shadow-sm rounded-lg">
            <nav class="-mb-px flex gap-6 px-6" aria-label="Tabs">
                <button id="tab-btn-fisica" type="button" class="tab-button active">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 0 1-.375.365l-2.036.873a3 3 0 0 1-3.218-4.22L4.5 12.75l-2.553-2.14a3 3 0 0 1 .11-5.176l2.036-.873.375-.365A3 3 0 0 1 9 4.243V3.236a3 3 0 0 1 4.22-3.218l2.14 2.553 2.14-2.553a3 3 0 0 1 4.22 3.218v1.007a3 3 0 0 1 .365.375l.873 2.036a3 3 0 0 1-5.176.11l-2.14-2.553-2.14 2.553a3 3 0 0 1-5.176-.11l-.873-2.036-.365-.375A3 3 0 0 1 3.236 9H4.243a3 3 0 0 1 3.218 4.22L4.5 16.5l2.553 2.14a3 3 0 0 1-.11 5.176l-2.036.873-.375.365A3 3 0 0 1 9 19.757v1.007a3 3 0 0 1-4.22 3.218L2.636 21.43A3 3 0 0 1 .11 16.254l2.14-2.553L.11 11.56a3 3 0 0 1 5.176-.11l2.036.873.365.375A3 3 0 0 1 9 15.757v1.007Z" /></svg>
                    Producción Física
                </button>
                <button id="tab-btn-digital" type="button" class="tab-button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9A2.25 2.25 0 0 0 4.5 18.75Z" /></svg>
                    Producción Digital
                </button>
                <button id="tab-btn-ideas" type="button" class="tab-button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-4.5 0m4.5 0v.75m-4.5-.75v.75m-7.5-12l.008-.007a7.5 7.5 0 0 1 14.984 0l.008.007M.75 10.5a7.5 7.5 0 1 1 15 0a7.5 7.5 0 0 1-15 0Z" /></svg>
                    Banco de Ideas
                </button>
            </nav>
        </div>
        <!-- FIN: Nueva Navegación -->

        <!-- INICIO: Contenido Pestaña 1 - Física -->
        <div id="tab-content-fisica" class="">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Columna Izquierda: Formulario de Creación -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-xl p-6 sticky top-6">
                        <h2 class="text-2xl font-bold text-gray-900">Crear Orden de Fabricación</h2>
                        <p class="mt-1 text-sm text-gray-600">Planifica un nuevo lote de producción.</p>
                        
                        <form id="crear-orden-form" class="mt-6 space-y-4">
                            
                            <!-- NUEVO: Campo Opcional de Idea -->
                            <div>
                                <label for="producto-idea-select" class="block text-sm font-medium text-gray-700">Asociar a Idea/Campaña (Opcional)</label>
                                <select id="producto-idea-select"
                                        class="idea-select-list mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                                    <option value="">Cargando ideas...</option>
                                    <!-- Opciones de `Ideas` se cargan aquí -->
                                </select>
                            </div>

                            <div>
                                <label for="producto-select" class="block text-sm font-medium text-gray-700">Producto a Fabricar</label>
                                <select id="producto-select" required
                                        class="producto-select-list mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                                    <option value="">Cargando productos...</option>
                                    <!-- Opciones de `PRODUCTOS.csv` se cargan aquí -->
                                </select>
                            </div>

                            <div>
                                <label for="cantidad-input" class="block text-sm font-medium text-gray-700">Cantidad a Producir</label>
                                <input type="number" id="cantidad-input" placeholder="100" min="1" required
                                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                            </div>

                            <div>
                                <label for="fecha-inicio-input" class="block text-sm font-medium text-gray-700">Fecha de Inicio Programada</label>
                                <input type="date" id="fecha-inicio-input" required
                                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                            </div>

                            <!-- Mensaje de feedback -->
                            <div id="form-feedback" class="text-sm h-5"></div>

                            <!-- Botón de Envío -->
                            <div class="pt-2">
                                <button type="submit" id="form-submit-btn"
                                        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-300">
                                    Crear Orden
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Columna Derecha: Lista de Órdenes -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-xl overflow-hidden">
                        <div class="p-6">
                            <h2 class="text-2xl font-bold text-gray-900">Órdenes de Fabricación Activas</h2>
                            <p class="mt-1 text-sm text-gray-600">Lista de `PRODUCCION_ORDENES`.</p>
                        </div>

                        <!-- Contenedor de la tabla -->
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Orden ID</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Producto</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cantidad</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha Programada</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                    </tr>
                                </thead>
                                <!-- Cuerpo de la tabla (se rellena con JS) -->
                                <tbody id="ordenes-tbody" class="bg-white divide-y divide-gray-200">
                                    <!-- (Contenido de tabla física) -->
                                    <tr id="ordenes-loader">
                                        <td colspan="5" class="px-6 py-12 text-center">
                                            <div class="flex justify-center items-center gap-2 text-gray-500">
                                                <svg class="animate-spin h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                                Cargando órdenes de producción...
                                            </div>
                                        </td>
                                    </tr>
                                    <tr id="ordenes-empty" class="hidden"><td colspan="5" class="px-6 py-12 text-center"><h3 class="text-lg font-medium text-gray-600">No hay órdenes activas</h3><p class="text-gray-500">Crea una nueva orden en el formulario.</p></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- FIN: Contenido Pestaña 1 -->

        <!-- INICIO: Contenido Pestaña 2 - Digital -->
        <div id="tab-content-digital" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Columna Izquierda: Formulario Digital (MODIFICADO) -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-xl p-6 sticky top-6">
                        <h2 class="text-2xl font-bold text-gray-900">Crear Tarea de Contenido</h2>
                        <p class="mt-1 text-sm text-gray-600">Planifica un nuevo activo digital (video, post, etc.)</p>
                        
                        <form id="crear-contenido-form" class="mt-6 space-y-4">
                            
                            <!-- NUEVO: Campo Opcional de Idea -->
                            <div>
                                <label for="contenido-idea-select" class="block text-sm font-medium text-gray-700">Asociar a Idea/Campaña (Opcional)</label>
                                <select id="contenido-idea-select"
                                        class="idea-select-list mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm">
                                    <option value="">Cargando ideas...</option>
                                    <!-- Opciones de `Ideas` se cargan aquí -->
                                </select>
                            </div>

                            <!-- Campo Checkboxes -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Tipo de Contenido (Selecciona uno o más)</label>
                                <fieldset id="contenido-tipo-checkboxes" class="mt-2 space-y-2 border border-gray-200 p-3 rounded-md">
                                    <div class="relative flex items-start">
                                        <div class="flex items-center h-5"><input id="tipo-video" value="Video" type="checkbox" class="focus:ring-purple-500 h-4 w-4 text-purple-600 border-gray-300 rounded"></div>
                                        <div class="ml-3 text-sm"><label for="tipo-video" class="font-medium text-gray-700">Video (Reel, YouTube)</label></div>
                                    </div>
                                    <div class="relative flex items-start">
                                        <div class="flex items-center h-5"><input id="tipo-blog" value="Post Blog" type="checkbox" class="focus:ring-purple-500 h-4 w-4 text-purple-600 border-gray-300 rounded"></div>
                                        <div class="ml-3 text-sm"><label for="tipo-blog" class="font-medium text-gray-700">Post Blog / Artículo</label></div>
                                    </div>
                                    <div class="relative flex items-start">
                                        <div class="flex items-center h-5"><input id="tipo-grafico" value="Gráfico" type="checkbox" class="focus:ring-purple-500 h-4 w-4 text-purple-600 border-gray-300 rounded"></div>
                                        <div class="ml-3 text-sm"><label for="tipo-grafico" class="font-medium text-gray-700">Gráfico (Carrusel, Infografía)</label></div>
                                    </div>
                                    <div class="relative flex items-start">
                                        <div class="flex items-center h-5"><input id="tipo-campana" value="Campaña" type="checkbox" class="focus:ring-purple-500 h-4 w-4 text-purple-600 border-gray-300 rounded"></div>
                                        <div class="ml-3 text-sm"><label for="tipo-campana" class="font-medium text-gray-700">Campaña (Email, Ads)</label></div>
                                    </div>
                                    <div class="relative flex items-start">
                                        <div class="flex items-center h-5"><input id="tipo-otro" value="Otro" type="checkbox" class="focus:ring-purple-500 h-4 w-4 text-purple-600 border-gray-300 rounded"></div>
                                        <div class="ml-3 text-sm"><label for="tipo-otro" class="font-medium text-gray-700">Otro</label></div>
                                    </div>
                                </fieldset>
                            </div>
                            
                            <div>
                                <label for="contenido-titulo-input" class="block text-sm font-medium text-gray-700">Título / Tarea</label>
                                <input type="text" id="contenido-titulo-input" placeholder="Ej: Video lanzamiento nuevo producto" required
                                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm">
                            </div>

                            <!-- Pilar de Contenido -->
                            <div>
                                <label for="contenido-pilar-select" class="block text-sm font-medium text-gray-700">Pilar de Contenido</label>
                                <select id="contenido-pilar-select" required
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm">
                                    <option value="">Seleccione un pilar...</option>
                                    <option value="Educativo">Educativo / Informativo</option>
                                    <option value="Inspiracional">Inspiracional / Motivacional</option>
                                    <option value="Entretenimiento">Entretenimiento</option>
                                    <option value="Comunidad">Comunidad / Interacción</option>
                                    <option value="Venta">Venta / Promoción</option>
                                </select>
                            </div>

                            <!-- Campo UTM -->
                            <div>
                                <label for="contenido-utm-input" class="block text-sm font-medium text-gray-700">UTM de Campaña (Opcional)</label>
                                <input type="text" id="contenido-utm-input" placeholder="ej: meta_video_lanzamiento"
                                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm">
                            </div>

                            <div>
                                <label for="producto-select-digital" class="block text-sm font-medium text-gray-700">Asociar a Producto (Opcional)</Gabel>
                                <select id="producto-select-digital"
                                        class="producto-select-list mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm">
                                    <option value="">Cargando productos...</option>
                                    <!-- Opciones de `PRODUCTOS.csv` se cargan aquí -->
                                </select>
                            </div>

                            <div>
                                <label for="contenido-fecha-input" class="block text-sm font-medium text-gray-700">Fecha de Entrega Programada</label>
                                <input type="date" id="contenido-fecha-input" required
                                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm">
                            </div>

                            <!-- Mensaje de feedback -->
                            <div id="form-contenido-feedback" class="text-sm h-5"></div>

                            <!-- Botón de Envío -->
                            <div class="pt-2">
                                <button type="submit" id="form-contenido-submit-btn"
                                        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors duration-300">
                                    Crear Tarea de Contenido
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Columna Derecha: Tabla Digital y Calendario -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Tabla Producción Digital -->
                    <div class="bg-white rounded-lg shadow-xl overflow-hidden">
                        <div class="p-6">
                            <h2 class="text-2xl font-bold text-gray-900">Tareas de Contenido (Kanban)</h2> <!-- TÍTULO CAMBIADO -->
                            <p class="mt-1 text-sm text-gray-600">Flujo de trabajo de contenido digital (BPM).</p>
                        </div>

                        <!-- Contenedor de la tabla -->
                        <!-- INICIO: Reemplazo de <table> por Kanban (MODIFICADO A 3 COLUMNAS) -->
                        <div class="kanban-board-container px-6 pb-6">
                            <div id="kanban-board" class="kanban-board">
                                <!-- Columna Por Hacer (To Do) -->
                                <div class="kanban-column">
                                    <h3 class="kanban-column-title text-gray-700">Por Hacer</h3>
                                    <div class="kanban-card-list" id="kanban-list-por-hacer">
                                        <div class="kanban-loader" id="kanban-loader-por-hacer">Cargando...</div>
                                        <div class="kanban-empty hidden" id="kanban-empty-por-hacer">Nada por hacer.</div>
                                    </div>
                                </div>
                                <!-- Columna En Progreso (Doing) -->
                                <div class="kanban-column">
                                    <h3 class="kanban-column-title text-blue-700">En Progreso</h3>
                                    <div class="kanban-card-list" id="kanban-list-en-progreso">
                                        <div class="kanban-loader" id="kanban-loader-en-progreso">Cargando...</div>
                                        <div class="kanban-empty hidden" id="kanban-empty-en-progreso">Nada en progreso.</div>
                                    </div>
                                </div>
                                <!-- Columna Hecho (Done) -->
                                <div class="kanban-column">
                                    <h3 class="kanban-column-title text-green-700">Hecho</h3>
                                    <div class="kanban-card-list" id="kanban-list-hecho">
                                        <div class="kanban-loader" id="kanban-loader-hecho">Cargando...</div>
                                        <div class="kanban-empty hidden" id="kanban-empty-hecho">Nada hecho.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- FIN: Reemplazo de <table> por Kanban -->
                    </div>

                    <!-- NUEVO: Calendario -->
                    <div class="bg-white rounded-lg shadow-xl p-6">
                        <div class="calendar-header">
                            <button id="calendar-prev-btn" type="button" title="Mes anterior">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" /></svg>
                            </button>
                            <h2 id="calendar-month-year" class="calendar-header-title"></h2>
                            <button id="calendar-next-btn" type="button" title="Mes siguiente">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" /></svg>
                            </button>
                        </div>
                        <div id="calendar-container">
                            <!-- El calendario se generará aquí -->
                        </div>
                        <p class="text-xs text-gray-500 mt-4 text-center">
                            <strong>TODO:</strong> Integrar con Google Calendar API para mostrar eventos reales.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- FIN: Contenido Pestaña 2 -->

        <!-- INICIO: Contenido Pestaña 3 - Banco de Ideas (MODIFICADO) -->
        <div id="tab-content-ideas" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Columna Izquierda: Añadir Idea -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-xl p-6 sticky top-6">
                        <h2 class="text-2xl font-bold text-gray-900">Añadir Nueva Idea</h2>
                        <p class="mt-1 text-sm text-gray-600">Guarda inspiración o brainstormings.</p>
                        
                        <form id="crear-idea-form" class="mt-6 space-y-4">
                            <!-- NUEVO: Tipo de Idea -->
                            <div>
                                <label for="tipo-idea-select" class="block text-sm font-medium text-gray-700">Tipo de Idea</label>
                                <select id="tipo-idea-select" required
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
                                    <option value="">Seleccione el tipo...</option>
                                    <option value="Campaña General">Campaña General</option>
                                    <option value="Idea de Producto">Idea de Producto</option>
                                    <option value="Idea de Contenido">Idea de Contenido</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="idea-titulo-input" class="block text-sm font-medium text-gray-700">Título de la Idea</label>
                                <input type="text" id="idea-titulo-input" placeholder="Ej: Campaña lanzamiento conos" required
                                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="idea-descripcion-textarea" class="block text-sm font-medium text-gray-700">Descripción</label>
                                <textarea id="idea-descripcion-textarea" rows="4" placeholder="Desarrollar la idea aquí..."
                                          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm"></textarea>
                            </div>

                            <div id="idea-feedback" class="text-sm h-5"></div>
                            
                            <div class="pt-2 space-y-3">
                                <button type="submit" id="idea-submit-btn"
                                        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-300">
                                    Guardar Idea
                                </button>
                                <button type="button" id="gemini-idea-btn"
                                        class="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-300">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09Z" /></svg>
                                    Generar ideas con IA (TODO)
                                </button>
                                <p class="text-xs text-gray-500 text-center">TODO: Integrar API de Gemini.</p>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Columna Derecha: Lista de Ideas -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-xl p-6">
                        <h2 class="text-2xl font-bold text-gray-900">Ideas Guardadas</h2>
                        <p class="mt-1 text-sm text-gray-600">Ideas listas para convertir en tareas.</p>

                        <div id="idea-list-container" class="mt-6 space-y-4">
                            <!-- Las ideas se cargarán aquí -->
                            <div id="idea-loader" class="text-center text-gray-500">Cargando ideas...</div>
                            <div id="idea-empty" class="text-center text-gray-500 hidden">No hay ideas guardadas.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- FIN: Contenido Pestaña 3 -->

    </main>
    
    <!-- 
      SCRIPT DE PÁGINA: PRODUCCIÓN
    -->
    <script>
      // URL del script de Google Apps (igual que en tu INDEX)
      const SCRIPT_URL = '<?= url ?>';

      // ==================================================================
      // LISTADO CENTRAL DE IMÁGENES (AÑADIDO DESDE INDEX)
      // ==================================================================
      const imageConfig = {
          logo: "https://i.postimg.cc/BQ2Sp0T4/Logotransparente.png"
      };

      function populateImages() {
          const images = document.querySelectorAll('[data-src-key]');
          images.forEach(img => {
              const key = img.getAttribute('data-src-key');
              if (imageConfig[key]) {
                  img.src = imageConfig[key];
              }
          });
      }
      // ==================================================================

      // --- Lógica de la Página ---
      document.addEventListener('DOMContentLoaded', () => {
          
          populateImages(); // Cargar el logo en el header
          
          // --- Referencias DOM: Pestañas ---
          const tabButtons = {
              fisica: document.getElementById('tab-btn-fisica'),
              digital: document.getElementById('tab-btn-digital'),
              ideas: document.getElementById('tab-btn-ideas')
          };
          const tabContents = {
              fisica: document.getElementById('tab-content-fisica'),
              digital: document.getElementById('tab-content-digital'),
              ideas: document.getElementById('tab-content-ideas')
          };

          // --- Referencias DOM: Formulario Físico ---
          const productoSelectList = document.querySelectorAll('.producto-select-list');
          const ideaSelectList = document.querySelectorAll('.idea-select-list'); // (NUEVO)
          const productoIdeaSelect = document.getElementById('producto-idea-select'); // (NUEVO)
          const cantidadInput = document.getElementById('cantidad-input');
          const fechaInicioInput = document.getElementById('fecha-inicio-input');
          const crearOrdenForm = document.getElementById('crear-orden-form');
          const formSubmitBtn = document.getElementById('form-submit-btn');
          const formFeedback = document.getElementById('form-feedback');

          // --- Referencias DOM: Tabla Física ---
          const ordenesTbody = document.getElementById('ordenes-tbody');
          const ordenesLoader = document.getElementById('ordenes-loader');
          const ordenesEmpty = document.getElementById('ordenes-empty');

          // --- Referencias DOM: Formulario Digital ---
          const crearContenidoForm = document.getElementById('crear-contenido-form');
          const contenidoIdeaSelect = document.getElementById('contenido-idea-select'); // (NUEVO)
          const contenidoTituloInput = document.getElementById('contenido-titulo-input');
          const contenidoPilarSelect = document.getElementById('contenido-pilar-select'); 
          const contenidoUtmInput = document.getElementById('contenido-utm-input'); 
          const productoSelectDigital = document.getElementById('producto-select-digital');
          const contenidoFechaInput = document.getElementById('contenido-fecha-input');
          const formContenidoSubmitBtn = document.getElementById('form-contenido-submit-btn');
          const formContenidoFeedback = document.getElementById('form-contenido-feedback');

          // --- Referencias DOM: Tabla Digital ---
          // (Se eliminan referencias a tareasTbody, tareasLoader, tareasEmpty)

          // --- Referencias DOM: Calendario ---
          const calendarContainer = document.getElementById('calendar-container');
          const calendarMonthYear = document.getElementById('calendar-month-year');
          const prevMonthBtn = document.getElementById('calendar-prev-btn');
          const nextMonthBtn = document.getElementById('calendar-next-btn');
          let currentCalendarDate = new Date();

          // --- Referencias DOM: Banco de Ideas ---
          const crearIdeaForm = document.getElementById('crear-idea-form');
          const tipoIdeaSelect = document.getElementById('tipo-idea-select'); // (NUEVO)
          const ideaTituloInput = document.getElementById('idea-titulo-input');
          const ideaDescripcionTextarea = document.getElementById('idea-descripcion-textarea');
          const ideaFeedback = document.getElementById('idea-feedback');
          const ideaSubmitBtn = document.getElementById('idea-submit-btn');
          const ideaListContainer = document.getElementById('idea-list-container');
          const ideaLoader = document.getElementById('idea-loader');
          const ideaEmpty = document.getElementById('idea-empty');
          const geminiIdeaBtn = document.getElementById('gemini-idea-btn');


          // --- Lógica de Pestañas (Tabs) ---
          function setupTabs() {
              Object.keys(tabButtons).forEach(key => {
                  tabButtons[key].addEventListener('click', () => switchTabs(key));
              });
          }

          function switchTabs(activeTab) {
              // Ocultar todo
              Object.keys(tabButtons).forEach(key => {
                  tabButtons[key].classList.remove('active');
                  tabContents[key].classList.add('hidden');
              });

              // Mostrar activo
              tabButtons[activeTab].classList.add('active');
              tabContents[activeTab].classList.remove('hidden');
          }

          // --- Lógica de Carga de Datos ---
          
          function mainLoad() {
              loadProductosDropdown();
              loadOrdenesProduccion();
              loadTareasContenido(); 
              loadIdeas(); // (MODIFICADO)
              
              // Setear fechas actuales por defecto
              fechaInicioInput.value = new Date().toISOString().split('T')[0];
              contenidoFechaInput.value = new Date().toISOString().split('T')[0];

              // Renderizar calendario
              renderCalendar(currentCalendarDate);
              prevMonthBtn.addEventListener('click', () => {
                  currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
                  renderCalendar(currentCalendarDate);
              });
              nextMonthBtn.addEventListener('click', () => {
                  currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
                  renderCalendar(currentCalendarDate);
              });
          }

          // 1. Cargar Productos para TODOS los Dropdowns
          function loadProductosDropdown() {
              google.script.run
                  .withSuccessHandler(renderProductosDropdown)
                  .withFailureHandler(showError)
                  .getProductosParaDropdown(); 
          }

          // 2. Cargar Órdenes de Producción
          function loadOrdenesProduccion() {
              ordenesLoader.classList.remove('hidden');
              ordenesEmpty.classList.add('hidden');
              ordenesTbody.innerHTML = ''; // Limpiar
              ordenesTbody.appendChild(ordenesLoader);
              
              google.script.run
                  .withSuccessHandler(renderOrdenesTabla)
                  .withFailureHandler(showError)
                  .getOrdenesProduccion(); 
          }

          // 3. Cargar Tareas de Contenido
          function loadTareasContenido() {
              document.querySelectorAll('.kanban-loader').forEach(el => el.classList.remove('hidden'));
              document.querySelectorAll('.kanban-empty').forEach(el => el.classList.add('hidden'));
              
              google.script.run
                  .withSuccessHandler(renderTareasTabla)
                  .withFailureHandler(showError)
                  .getTareasContenido(); 
          }

          // 4. Cargar Ideas (MODIFICADO - Ahora también puebla los dropdowns)
          function loadIdeas() {
              ideaLoader.classList.remove('hidden');
              ideaEmpty.classList.add('hidden');
              ideaListContainer.innerHTML = ''; // Limpiar
              ideaListContainer.appendChild(ideaLoader);

              // *** MOCKUP: Reemplazar con google.script.run ***
              setTimeout(() => {
                  const mockIdeas = {
                      success: true,
                      ideas: [
                          { Tarea_ID: "I-001", Titulo: "5 mitos sobre el producto X", Descripcion: "Hacer un reel rápido desmintiendo cosas.", Tipo: "Idea de Contenido" },
                          { Tarea_ID: "I-002", Titulo: "Tutorial de uso avanzado", Descripcion: "Video largo para YouTube mostrando funciones pro.", Tipo: "Idea de Contenido" },
                          { Tarea_ID: "C-001", Titulo: "Campaña Lanzamiento Conos", Descripcion: "Campaña integral para nuevos conos de helado.", Tipo: "Campaña General" },
                          { Tarea_ID: "P-001", Titulo: "Nuevo Cono de Chocolate Blanco", Descripcion: "Desarrollar prototipo y costeo.", Tipo: "Idea de Producto" }
                      ]
                  };
                  renderIdeas(mockIdeas);
              }, 1000);
              // google.script.run.withSuccessHandler(renderIdeas).withFailureHandler(showError).getIdeasContenido();
          }


          // --- Lógica de Renderizado ---

          // 1. Renderizar Dropdown de Productos
          function renderProductosDropdown(response) {
              if (response.success && response.productos.length > 0) {
                  
                  productoSelectList.forEach(select => {
                      select.innerHTML = '<option value="">Seleccione un producto...</option>'; // Reset
                      response.productos.forEach(prod => {
                          const option = document.createElement('option');
                          option.value = prod.PRODUCTO_ID; // O el ID que uses
                          option.textContent = `${prod.Nombre} (ID: ${prod.PRODUCTO_ID})`;
                          select.appendChild(option);
                      });
                  });

              } else {
                  productoSelectList.forEach(select => {
                      select.innerHTML = '<option value="">Error al cargar productos</option>';
                  });
                  showError(new Error(response.error || 'No se encontraron productos.'));
              }
          }
          
          // 2. Renderizar Tabla de Órdenes (Sin cambios)
          function renderOrdenesTabla(response) {
              ordenesLoader.classList.add('hidden');
              ordenesTbody.innerHTML = ''; // Limpiar todo

              if (response.success && response.ordenes.length > 0) {
                  response.ordenes.forEach(item => {
                      const tr = document.createElement('tr');
                      tr.classList.add('hover:bg-gray-50');
                      
                      let estadoColor = 'bg-gray-100 text-gray-800'; // Default
                      if (item.Estado === 'Pendiente') estadoColor = 'bg-yellow-100 text-yellow-800';
                      if (item.Estado === 'En Proceso') estadoColor = 'bg-blue-100 text-blue-800';
                      if (item.Estado === 'Completada') estadoColor = 'bg-green-100 text-green-800';
                      if (item.Estado === 'Cancelada') estadoColor = 'bg-red-100 text-red-800';

                      tr.innerHTML = `
                          <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${item.Orden_ID}</div><div class="text-xs text-gray-500">Idea: ${item.Idea_ID || 'N/A'}</div></td>
                          <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-700">${item.Producto_Nombre}</div><div class="text-xs text-gray-500">ID: ${item.PRODUCTO_ID}</div></td>
                          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">${item.Cantidad}</td>
                          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${item.Fecha_Programada}</td>
                          <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${estadoColor}">${item.Estado}</span></td>
                      `;
                      ordenesTbody.appendChild(tr);
                  });
              
              } else {
                  ordenesTbody.appendChild(ordenesEmpty);
                  ordenesEmpty.classList.remove('hidden');
              }
          }

          // 3. Renderizar Tareas de Contenido (REESCRITO PARA KANBAN 3 COLUMNAS)
          function renderTareasTabla(response) {
              // 1. Ocultar todos los loaders
              document.querySelectorAll('.kanban-loader').forEach(el => el.classList.add('hidden'));

              // 2. Definir los contenedores de lista
              const lists = {
                  'Por Hacer': document.getElementById('kanban-list-por-hacer'),
                  'En Progreso': document.getElementById('kanban-list-en-progreso'),
                  'Hecho': document.getElementById('kanban-list-hecho')
              };
              
              // 3. Limpiar contenido (excepto loaders/empty states que están hardcoded)
              Object.values(lists).forEach(list => {
                  if (list) list.innerHTML = ''; // Limpiar totalmente
              });
              
              if (response.success && response.tareas.length > 0) {
                  // 4. Poblar las tarjetas
                  response.tareas.forEach(item => {
                      
                      let targetList;
                      // Lógica de Mapeo
                      switch (item.Estado) {
                          case 'Planeado':
                              targetList = lists['Por Hacer'];
                              break;
                          case 'Guión':
                          case 'Grabación':
                          case 'Edición':
                          case 'Revisión':
                              targetList = lists['En Progreso'];
                              break;
                          case 'Publicado':
                              targetList = lists['Hecho'];
                              break;
                          default:
                              // Si el estado es desconocido, va a 'Por Hacer'
                              targetList = lists['Por Hacer'];
                      }
                      
                      if (targetList) {
                          const card = document.createElement('div');
                          card.className = 'kanban-card';
                          // Opcional: añadir ID para drag-and-drop futuro
                          // card.dataset.taskId = item.Tarea_ID; 

                          const tiposHtml = Array.isArray(item.Tipos) ? item.Tipos.map(tipo => 
                              `<span class="kanban-card-pill bg-purple-100 text-purple-800">${tipo}</span>`
                          ).join('') : `<span class="kanban-card-pill bg-purple-100 text-purple-800">${item.Tipo}</span>`;

                          card.innerHTML = `
                              <h4 class="kanban-card-title">${item.Titulo}</h4>
                              <p class="text-xs text-gray-500 mt-1">Idea: ${item.Idea_ID || 'N/A'}</p>
                              <div class="kanban-card-pills mt-2">
                                  ${tiposHtml}
                                  <span class="kanban-card-pill bg-gray-100 text-gray-800">${item.Pilar || 'N/A'}</span>
                              </div>
                              <div class="mt-2 pt-2 border-t border-gray-100 flex justify-between items-center">
                                  <span class="text-xs text-gray-500">${item.Fecha_Entrega}</span>
                                  <!-- Aquí irían avatares/asignados si los tuvieras -->
                              </div>
                          `;
                          targetList.appendChild(card);
                      }
                  });
              }
              
              // 5. Mostrar "empty" si alguna lista está vacía
              const emptyTexts = {
                  'Por Hacer': 'Nada por hacer.',
                  'En Progreso': 'Nada en progreso.',
                  'Hecho': 'Nada hecho.'
              };
              Object.keys(lists).forEach(key => {
                  const listEl = lists[key];
                  if (listEl && listEl.children.length === 0) {
                      // (Re-crear el 'empty' state que borramos)
                      listEl.innerHTML = `<div class="kanban-empty">${emptyTexts[key]}</div>`;
                  }
              });
          }

          // 4. Renderizar Calendario (Sin cambios)
          function renderCalendar(date) {
              calendarContainer.innerHTML = '';
              const year = date.getFullYear();
              const month = date.getMonth();
              const today = new Date();
              
              calendarMonthYear.textContent = date.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });

              const firstDay = new Date(year, month, 1);
              const lastDay = new Date(year, month + 1, 0);
              const lastDayIndex = lastDay.getDay();
              const lastDayDate = lastDay.getDate();
              const prevLastDay = new Date(year, month, 0);
              const prevLastDayDate = prevLastDay.getDate();
              const nextDays = 7 - (lastDayIndex + 1); 

              const weekdays = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
              
              let gridHtml = '<div class="calendar-grid">';
              
              weekdays.forEach(day => {
                  gridHtml += `<div class="calendar-day-header">${day}</div>`;
              });

              let startDay = firstDay.getDay(); // 0 = Domingo, 1 = Lunes
              for (let x = startDay; x > 0; x--) {
                  gridHtml += `<div class="calendar-day other-month"><div class="calendar-day-number">${prevLastDayDate - x + 1}</div></div>`;
              }

              for (let i = 1; i <= lastDayDate; i++) {
                  let isToday = (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) ? 'today' : '';
                  gridHtml += `<div class="calendar-day ${isToday}">
                                  <div class="calendar-day-number">${i}</div>`;
                  if (i === 15) {
                      gridHtml += `<div class="calendar-event">Lanzamiento Video</div>`;
                  }
                  gridHtml += `</div>`;
              }

              for (let j = 1; j <= nextDays; j++) {
                  gridHtml += `<div class="calendar-day other-month"><div class="calendar-day-number">${j}</div></div>`;
              }

              gridHtml += '</div>';
              calendarContainer.innerHTML = gridHtml;
          }

          // 5. Renderizar Ideas (Sin cambios)
          function renderIdeas(response) {
              ideaLoader.classList.add('hidden');
              ideaListContainer.innerHTML = ''; // Limpiar loader
              
              // Poblar los Dropdowns de Ideas
              const ideaDropdowns = document.querySelectorAll('.idea-select-list');
              ideaDropdowns.forEach(select => {
                  select.innerHTML = '<option value="">(Opcional) Seleccionar Idea...</option>';
              });
              
              if (response.success && response.ideas.length > 0) {
                  response.ideas.forEach(idea => {
                      // 1. Poblar la lista del Banco de Ideas
                      const ideaCard = document.createElement('div');
                      ideaCard.className = 'p-3 border rounded-lg bg-gray-50 hover:bg-gray-100 relative';
                      
                      let tagClass = 'tag-contenido';
                      if (idea.Tipo === 'Idea de Producto') tagClass = 'tag-producto';
                      if (idea.Tipo === 'Campaña General') tagClass = 'tag-campana';

                      ideaCard.innerHTML = `
                          <span class_="${tagClass} idea-card-tag">${idea.Tipo}</span>
                          <h4 class="font-semibold text-gray-800">${idea.Titulo}</h4>
                          <p class="text-sm text-gray-600 mt-1">${idea.Descripcion}</p>
                          <button type="button" class="convert-idea-btn text-xs text-purple-600 hover:text-purple-800 font-medium mt-2">
                              Convertir en Tarea
                          </button>
                      `;
                      // Añadir listener al botón "Convertir"
                      ideaCard.querySelector('.convert-idea-btn').addEventListener('click', () => {
                          handleConvertirIdea(idea);
                      });
                      ideaListContainer.appendChild(ideaCard);

                      // 2. Poblar los dropdowns en los otros formularios
                      ideaDropdowns.forEach(select => {
                          const option = document.createElement('option');
                          option.value = idea.Tarea_ID;
                          option.textContent = `[${idea.Tipo}] ${idea.Titulo}`;
                          select.appendChild(option);
                      });
                  });
              } else {
                  ideaEmpty.classList.remove('hidden');
              }
          }

          // --- Lógica de Formulario de Creación (Físico) --- (Sin cambios)
          
          crearOrdenForm.addEventListener('submit', handleOrdenSubmit);

          function handleOrdenSubmit(e) {
              e.preventDefault();
              formSubmitBtn.disabled = true;
              formSubmitBtn.textContent = 'Creando...';
              showFormFeedback(formFeedback, '', false);
              
              const ordenData = {
                  ideaId: productoIdeaSelect.value, // (NUEVO)
                  productoId: document.getElementById('producto-select').value, 
                  productoNombre: document.getElementById('producto-select').options[document.getElementById('producto-select').selectedIndex].text,
                  cantidad: cantidadInput.value,
                  fechaInicio: fechaInicioInput.value
              };
              
              if (!ordenData.productoId || !ordenData.cantidad || !ordenData.fechaInicio) {
                  showFormFeedback(formFeedback, 'Por favor, complete todos los campos.', false);
                  formSubmitBtn.disabled = false;
                  formSubmitBtn.textContent = 'Crear Orden';
                  return;
              }

              google.script.run
                  .withSuccessHandler(onOrdenCreada)
                  .withFailureHandler(onOrdenError)
                  .crearOrdenProduccion(ordenData); 
          }

          function onOrdenCreada(response) {
              if (response.success) {
                  showFormFeedback(formFeedback, 'Orden de producción creada exitosamente.', true);
                  crearOrdenForm.reset();
                  fechaInicioInput.value = new Date().toISOString().split('T')[0]; 
                  loadOrdenesProduccion(); 
              } else {
                  onOrdenError(new Error(response.message || 'Error desconocido al guardar.'));
              }
              formSubmitBtn.disabled = false;
              formSubmitBtn.textContent = 'Crear Orden';
          }
          
          function onOrdenError(error) {
              showFormFeedback(formFeedback, error.message, false);
              formSubmitBtn.disabled = false;
              formSubmitBtn.textContent = 'Crear Orden';
          }
          

          // --- Lógica de Formulario de Creación (Digital) (MODIFICADO) --- (Sin cambios)
          
          crearContenidoForm.addEventListener('submit', handleContenidoSubmit);

          function handleContenidoSubmit(e) {
              e.preventDefault();
              formContenidoSubmitBtn.disabled = true;
              formContenidoSubmitBtn.textContent = 'Creando...';
              showFormFeedback(formContenidoFeedback, '', false); 

              const tiposSeleccionados = [];
              document.querySelectorAll('#contenido-tipo-checkboxes input[type="checkbox"]:checked').forEach(cb => {
                  tiposSeleccionados.push(cb.value);
              });

              const tareaData = {
                  ideaId: contenidoIdeaSelect.value, // (NUEVO)
                  tipos: tiposSeleccionados, 
                  titulo: contenidoTituloInput.value,
                  pilar: contenidoPilarSelect.value, 
                  utm: contenidoUtmInput.value, 
                  productoId: productoSelectDigital.value,
                  productoNombre: productoSelectDigital.options[productoSelectDigital.selectedIndex].text,
                  fechaEntrega: contenidoFechaInput.value
              };
              
              if (tiposSeleccionados.length === 0 || !tareaData.titulo || !tareaData.pilar || !tareaData.fechaEntrega) {
                  showFormFeedback(formContenidoFeedback, 'Por favor, complete Tipos, Título, Pilar y Fecha.', false);
                  formContenidoSubmitBtn.disabled = false;
                  formContenidoSubmitBtn.textContent = 'Crear Tarea de Contenido';
                  return;
              }

              google.script.run
                  .withSuccessHandler(onContenidoCreado)
                  .withFailureHandler(onContenidoError)
                  .crearTareaContenido(tareaData); 
          }

          function onContenidoCreado(response) {
              if (response.success) {
                  showFormFeedback(formContenidoFeedback, 'Tarea de contenido creada exitosamente.', true);
                  crearContenidoForm.reset();
                  contenidoFechaInput.value = new Date().toISOString().split('T')[0]; 
                  loadTareasContenido(); // Recargar la tabla de tareas
              } else {
                  onContenidoError(new Error(response.message || 'Error desconocido al guardar.'));
              }
              formContenidoSubmitBtn.disabled = false;
              formContenidoSubmitBtn.textContent = 'Crear Tarea de Contenido';
          }
          
          function onContenidoError(error) {
              showFormFeedback(formContenidoFeedback, error.message, false);
              formContenidoSubmitBtn.disabled = false;
              formContenidoSubmitBtn.textContent = 'Crear Tarea de Contenido';
          }

          // --- Lógica de Formulario de Ideas (MODIFICADO) --- (Sin cambios)
          crearIdeaForm.addEventListener('submit', handleIdeaSubmit);
          geminiIdeaBtn.addEventListener('click', () => {
              showFormFeedback(ideaFeedback, 'TODO: Integración con API de Gemini', false);
          });

          function handleIdeaSubmit(e) {
              e.preventDefault();
              const titulo = ideaTituloInput.value;
              const descripcion = ideaDescripcionTextarea.value;
              const tipo = tipoIdeaSelect.value; // (NUEVO)

              if (!titulo || !tipo) { // (MODIFICADO)
                  showFormFeedback(ideaFeedback, 'Por favor, ingrese un Título y un Tipo de Idea.', false);
                  return;
              }

              ideaSubmitBtn.disabled = true;
              ideaSubmitBtn.textContent = 'Guardando...';

              // *** MOCKUP: Reemplazar con google.script.run ***
              setTimeout(() => {
                  showFormFeedback(ideaFeedback, 'Idea guardada exitosamente (Mockup).', true);
                  crearIdeaForm.reset();
                  ideaSubmitBtn.disabled = false;
                  ideaSubmitBtn.textContent = 'Guardar Idea';
                  loadIdeas(); // Recargar la lista de ideas
              }, 1000);
              // google.script.run.withSuccessHandler(onIdeaGuardada).withFailureHandler(onIdeaError).crearIdeaContenido({titulo, descripcion, tipo});
          }
          
          function onIdeaGuardada(response) {
                if (response.success) {
                    showFormFeedback(ideaFeedback, 'Idea guardada exitosamente.', true);
                    crearIdeaForm.reset();
                    loadIdeas(); // Recargar la lista de ideas y dropdowns
                } else {
                    onIdeaError(new Error(response.message || 'Error al guardar idea.'));
                }
                ideaSubmitBtn.disabled = false;
                ideaSubmitBtn.textContent = 'Guardar Idea';
          }

          function onIdeaError(error) {
              showFormFeedback(ideaFeedback, error.message, false);
              ideaSubmitBtn.disabled = false;
              ideaSubmitBtn.textContent = 'Guardar Idea';
          }

          // --- Lógica de Conversión de Ideas (NUEVO) --- (Sin cambios)
          function handleConvertirIdea(idea) {
              if (idea.Tipo === 'Idea de Producto') {
                  switchTabs('fisica');
                  productoIdeaSelect.value = idea.Tarea_ID;
                  // Opcional: enfocar el siguiente campo
                  document.getElementById('producto-select').focus();
              } else {
                  // "Idea de Contenido" y "Campaña General" van al formulario digital
                  switchTabs('digital');
                  contenidoIdeaSelect.value = idea.Tarea_ID;
                  contenidoTituloInput.value = idea.Titulo; // Pre-llenar título
                  // Opcional: enfocar el siguiente campo
                  document.getElementById('contenido-pilar-select').focus();
              }
          }

          // --- Utilidad de Feedback --- (Sin cambios)
          function showFormFeedback(element, message, isSuccess) {
              element.textContent = message;
              element.className = isSuccess ? 'text-sm text-green-600' : 'text-sm text-red-600';
              
              setTimeout(() => {
                  element.textContent = '';
              }, 4000);
          }

          // --- Manejo de Errores Global --- (MODIFICADO)
          function showError(error) {
              console.error('Error en Google Apps Script:', error);
              // Ocultar loaders
              ordenesLoader.classList.add('hidden');
              document.querySelectorAll('.kanban-loader').forEach(el => el.classList.add('hidden'));
              ideaLoader.classList.add('hidden');
              
              // Mostrar error en las tablas
              ordenesTbody.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-red-600"><strong>Error al cargar:</strong> ${error.message}</td></tr>`;
              
              // Mostrar error en Kanban
              const kanbanBoard = document.getElementById('kanban-board');
              if (kanbanBoard) {
                  kanbanBoard.innerHTML = `<div class="text-center text-red-600 p-6"><strong>Error al cargar:</strong> ${error.message}</div>`;
              }

              ideaListContainer.innerHTML = `<div class="text-center text-red-600"><strong>Error al cargar:</strong> ${error.message}</div>`;
              
              // Mostrar error en los dropdowns
              productoSelectList.forEach(select => {
                  select.innerHTML = `<option value="">Error: ${error.message}</option>`;
              });
              ideaSelectList.forEach(select => {
                  select.innerHTML = `<option value="">Error: ${error.message}</option>`;
              });
L          }

          // --- NAVEGACIÓN DEL DASHBOARD (Copiado de FINANZAS.html) --- (Sin cambios)
          function handleNavigation(pageId) {
              console.log('Navegar a:', pageId);
              if (pageId === 'INDEX') {
                  window.top.location.href = SCRIPT_URL;
              } else {
                  window.top.location.href = SCRIPT_URL + "?page=" + pageId;
              }
          }

          // --- INICIO: CORRECCIÓN DE ERROR "google is not defined" --- (Sin cambios)
          function runWhenReady(func) {
              if (typeof google !== 'undefined' && google.script && google.script.run) {
                  func();
              } else {
                  setTimeout(() => runWhenReady(func), 100); // Reintentar en 100ms
              }
          }
          // --- FIN: CORRECCIÓN DE ERROR ---

          // --- Carga Inicial --- (Sin cambios)
          setupTabs(); // Configurar los listeners de las pestañas
          runWhenReady(mainLoad); // Llamada corregida
      });
    </script>
</body>
</html>